{
  "Name":"BusinessOrder",
  "Comment":"business pacle order",
  "Version":"0.0.1",
  "StartState":"orderService",
  "States":{
    "orderService":{
      "Type":"ServiceTask",
      "Comment":"orderService",
      "ServiceName":"cn.dmego.seata.saga.business.proxy.OrderService",
      "ServiceMethod":"createOrder",
      "CompensateState":"compensateOrder",
      "Input":[
        "$.[orderId]",
        "$.[userId]",
        "$.[productId]",
        "$.[amount]",
        "$.[count]"
      ],
      "Output":{
        "orderResult":"$.#root"
      },
      "Status":{
        "#root == true":"SU",
        "#root == false":"FA",
        "$Exception{java.lang.Throwable}":"UN"
      },
      "Catch":[
        {
          "Exceptions":[
            "java.lang.Throwable"
          ],
          "Next":"CompensationTrigger"
        }
      ],
      "Next":"orderChoice"
    },
    "orderChoice":{
      "Comment":"orderChoice",
      "Type":"Choice",
      "Choices":[
        {
          "Expression":"[orderResult] == true",
          "Next":"accountService"
        },
        {
          "Expression":"[orderResult] == false",
          "Next":"CompensationTrigger"
        }
      ]
    },
    "accountService":{
      "Type":"ServiceTask",
      "Comment":"accountService",
      "ServiceName":"cn.dmego.seata.saga.business.proxy.AccountService",
      "ServiceMethod":"reduceBalance",
      "CompensateState":"compensateAccount",
      "Input":[
        "$.[userId]",
        "$.[amount]"
      ],
      "Output":{
        "accountResult":"$.#root"
      },
      "Status":{
        "#root == true":"SU",
        "#root == false":"FA",
        "$Exception{java.lang.Throwable}":"UN"
      },
      "Catch":[
        {
          "Exceptions":[
            "java.lang.Throwable"
          ],
          "Next":"CompensationTrigger"
        }
      ],
      "Next":"accountChoice"
    },
    "accountChoice":{
      "Comment":"accountChoice",
      "Type":"Choice",
      "Choices":[
        {
          "Expression":"[accountResult] == true",
          "Next":"productService"
        },
        {
          "Expression":"[accountResult] == false",
          "Next":"CompensationTrigger"
        }
      ]
    },
    "productService":{
      "Type":"ServiceTask",
      "Comment":"productService",
      "ServiceName":"cn.dmego.seata.saga.business.proxy.ProductService",
      "ServiceMethod":"reduceStock",
      "CompensateState":"compensateStock",
      "Input":[
        "$.[productId]",
        "$.[count]"
      ],
      "Output":{
        "productResult":"$.#root"
      },
      "Status":{
        "#root == true":"SU",
        "#root == false":"FA",
        "$Exception{java.lang.Throwable}":"UN"
      },
      "Catch":[
        {
          "Exceptions":[
            "java.lang.Throwable"
          ],
          "Next":"CompensationTrigger"
        }
      ],
      "Next":"Succeed"
    },
    "compensateOrder":{
      "Type":"ServiceTask",
      "Comment":"compensateOrder",
      "ServiceName":"cn.dmego.seata.saga.business.proxy.OrderService",
      "ServiceMethod":"revokeOrder",
      "Input":[
        "$.[orderId]"
      ]
    },
    "compensateAccount":{
      "Type":"ServiceTask",
      "Comment":"compensateAccount",
      "ServiceName":"cn.dmego.seata.saga.business.proxy.AccountService",
      "ServiceMethod":"compensateBalance",
      "Input":[
        "$.[userId]",
        "$.[amount]"
      ]
    },
    "compensateStock":{
      "Type":"ServiceTask",
      "Comment":"compensateStock",
      "ServiceName":"cn.dmego.seata.saga.business.proxy.ProductService",
      "ServiceMethod":"compensateStock",
      "Input":[
        "$.[productId]",
        "$.[count]"
      ]
    },
    "CompensationTrigger":{
      "Type":"CompensationTrigger",
      "Next":"Fail"
    },
    "Fail":{
      "Comment":"Fail",
      "ErrorCode":"PURCHASE_FAILED",
      "Message":"purchase failed",
      "Type":"Fail"
    },
    "Succeed":{
      "Comment":"Succeed",
      "Type":"Succeed"
    }
  }
}